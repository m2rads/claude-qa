| Given | When | Then |
|-------|------|------|
| A valid token with proper authorization | A GET request is made to /DeleteAndRecreateDptQueues with the valid token | - Response status code is 200<br>- Response body contains "true" indicating success<br>- All Service Bus Queues in the namespace are deleted and recreated<br>- No messages remain in any queue |
| An invalid token | A GET request is made to /DeleteAndRecreateDptQueues with an invalid token | - Response status code is 401 (Unauthorized)<br>- Response body contains an error message about invalid token<br>- No changes are made to the Service Bus Queues |
| A valid token with insufficient permissions | A GET request is made to /DeleteAndRecreateDptQueues with a token lacking necessary permissions | - Response status code is 403 (Forbidden)<br>- Response body contains an error message about insufficient permissions<br>- No changes are made to the Service Bus Queues |
| A valid token, but the system is in a state where queue deletion is not allowed | A GET request is made to /DeleteAndRecreateDptQueues | - Response status code is 409 (Conflict)<br>- Response body contains an error message about the current system state<br>- No changes are made to the Service Bus Queues |
| A valid token, but there's an ongoing operation affecting the queues | A GET request is made to /DeleteAndRecreateDptQueues | - Response status code is 423 (Locked)<br>- Response body contains an error message about the ongoing operation<br>- No changes are made to the Service Bus Queues |
| A valid token, but the Service Bus is temporarily unavailable | A GET request is made to /DeleteAndRecreateDptQueues | - Response status code is 503 (Service Unavailable)<br>- Response body contains an error message about the Service Bus being unavailable<br>- No changes are made to the Service Bus Queues |
| A valid token, and the operation is initiated successfully but fails midway | A GET request is made to /DeleteAndRecreateDptQueues | - Response status code is 500 (Internal Server Error)<br>- Response body contains an error message about partial completion<br>- The system should be in a consistent state (either all queues deleted or all original queues intact) |
| A valid token, with existing messages in the queues | A GET request is made to /DeleteAndRecreateDptQueues | - Response status code is 200<br>- Response body contains "true" indicating success<br>- All queues are deleted and recreated, and all messages are permanently deleted |
| A valid token, immediately followed by another identical request | Two consecutive GET requests are made to /DeleteAndRecreateDptQueues | - First request: status code 200, body contains "true"<br>- Second request: status code 409 (Conflict) or 423 (Locked), body contains error message about ongoing operation |
| No token provided | A GET request is made to /DeleteAndRecreateDptQueues without a token | - Response status code is 400 (Bad Request)<br>- Response body contains an error message about missing token<br>- No changes are made to the Service Bus Queues |
